
@{
    ViewData["Title"] = "Chat";
}

<!--SignalR client-->
<script src="~/signalr-client-1.0.0-alpha2-final.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        let connection = new signalR.HubConnection('/chat');

        //Receive Data from server
        connection.on('send', function (data, data2) {
            let child = document.createElement('li');
            child.innerText = data;
            document.getElementById('messages').appendChild(child);
            document.getElementById('numberOfUsers').innerHTML = data2;
        });

        //Receive data only for signed user
        connection.on('client', function (data) {
            document.getElementById('extra').innerHTML = data;
        })

        //Receive list of online users
        connection.on('OnlineUsers', function (data) {
            for (var i = 0; i < data.length; i++) {
                document.getElementById('chat-text').innerHTML += '<p>' +data[i]+'</p>';
            }
        })

        //Sending data to server .......
        document.getElementById('sendmessage').addEventListener('submit', event => {
            let data = document.getElementById('data').value;
            connection.invoke('send', data);
            connection.invoke('sendClient', data);
            event.preventDefault();
        });

        connection.start().then(function () {
            console.log("Started....");
        })
            .catch(function (err) {
                console.log("Error");
            })
    });
</script>

<div class="row chat" style="overflow:hidden">
    <div class="col-md-3" style="height:100vh; background:#111; color:#d46d15;">
        <h5>Number Of Users Online:<span style="padding-left:15px;" id="numberOfUsers"></span></h5>
        <h3 class="text-center" style="text-decoration:underline;">EVENTS</h3>

    </div>
    <div class="col-md-9" style="background:#ddd; height:100vh;">
        <div class="col-md-12">
            <h2 class="text-center" style="color:#d46d15;">Welcome to Scaffolders Chat</h2>
        </div>
        <div class="col-md-12">
            <div id="chat-text" style="overflow-y:scroll; height: 75vh;border: 2px solid rgba(212,109,21, 0.7); outline:3px solid rgba(212,109,21, 1);">
                <ul id="messages" style="overflow:hidden; list-style:none"></ul>
            </div>

            <form id="sendmessage" style="margin-top:5px;">
                <div class="input-group" style="width:100%;">
                    <input style="width:100%; height:40px" type="text" id="data" />
                    <span class="input-group-btn">
                        <input type="image" src="~/images/send.png" alt="Submit" width="40" height="40" style="cursor:pointer">
                    </span>
                </div>
                
            </form>

        </div>
    </div>
</div>






